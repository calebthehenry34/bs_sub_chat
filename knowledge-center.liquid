{% comment %}
  Knowledge Center Template

  Installation Instructions:
  1. Upload knowledge-center.js to your Shopify theme's Assets folder
  2. Create a new page template in Shopify Admin
  3. Paste this code into the template file
  4. Assign the template to a page (e.g., /pages/knowledge-center)

  Theme Settings Integration:
  You can add these settings to your theme's settings_schema.json to make the knowledge center customizable:

  {
    "name": "Knowledge Center",
    "settings": [
      {
        "type": "text",
        "id": "kc_backend_url",
        "label": "Backend URL",
        "default": "https://your-backend.vercel.app"
      },
      {
        "type": "color",
        "id": "kc_primary_color",
        "label": "Primary Color",
        "default": "#2563eb"
      },
      {
        "type": "color",
        "id": "kc_secondary_color",
        "label": "Secondary Color",
        "default": "#64748b"
      },
      {
        "type": "checkbox",
        "id": "kc_enable_search",
        "label": "Enable Search",
        "default": true
      },
      {
        "type": "checkbox",
        "id": "kc_enable_categories",
        "label": "Enable Categories",
        "default": true
      }
    ]
  }
{% endcomment %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }} - {{ shop.name }}</title>

  {% comment %} Include your theme's CSS {% endcomment %}
  {{ content_for_header }}

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    .page-container {
      max-width: 100%;
      margin: 0 auto;
      padding: 20px 0;
    }

    {% comment %} Optional: Add custom styles {% endcomment %}
    .kc-container {
      background: {{ settings.kc_background_color | default: '#ffffff' }};
    }
  </style>
</head>
<body>
  {% comment %} Optional: Include your theme's header {% endcomment %}
  {% section 'header' %}

  <div class="page-container">
    {% comment %} Knowledge Center Container {% endcomment %}
    <div id="knowledge-center-container"></div>
  </div>

  {% comment %} Optional: Include your theme's footer {% endcomment %}
  {% section 'footer' %}

  {% comment %} Load Knowledge Center Script {% endcomment %}
  <script src="{{ 'knowledge-center.js' | asset_url }}"></script>

  <script>
    // Get user tags from customer metafields or tags
    // This is an example - adjust based on your Shopify setup
    var userTags = [];

    {% if customer %}
      {% comment %}
        Option 1: Use customer tags
        In Shopify Admin, you can add tags to customers like "affiliates", "vip", etc.
      {% endcomment %}
      {% if customer.tags contains 'affiliates' %}
        userTags.push('affiliates');
      {% endif %}

      {% if customer.tags contains 'vip' %}
        userTags.push('vip');
      {% endif %}

      {% if customer.tags contains 'premium' %}
        userTags.push('premium');
      {% endif %}

      {% comment %}
        Option 2: Use customer metafields (requires Shopify Plus or custom app)
        {% assign customer_tier = customer.metafields.custom.tier %}
        {% if customer_tier == 'affiliate' %}
          userTags.push('affiliates');
        {% endif %}
      {% endcomment %}
    {% endif %}

    // Initialize Knowledge Center
    document.addEventListener('DOMContentLoaded', function() {
      const knowledgeCenter = new KnowledgeCenter({
        // Backend configuration
        backendUrl: '{{ settings.kc_backend_url | default: "https://your-backend.vercel.app" }}',

        // User information
        userEmail: {% if customer %}'{{ customer.email }}'{% else %}null{% endif %},
        userTags: userTags,

        // Container
        containerId: 'knowledge-center-container',

        // Features
        enableSearch: {{ settings.kc_enable_search | default: true }},
        enableCategories: {{ settings.kc_enable_categories | default: true }},
        enableAnalytics: true,

        // Display options
        articlesPerPage: 12,
        showFeaturedFirst: true,

        // Theme customization
        theme: {
          primaryColor: '{{ settings.kc_primary_color | default: "#2563eb" }}',
          secondaryColor: '{{ settings.kc_secondary_color | default: "#64748b" }}',
          backgroundColor: '{{ settings.kc_background_color | default: "#ffffff" }}',
          textColor: '{{ settings.kc_text_color | default: "#1e293b" }}',
          borderRadius: '{{ settings.kc_border_radius | default: "8px" }}',
          fontFamily: '{{ settings.kc_font_family | default: "-apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif" }}',
          cardShadow: '0 1px 3px rgba(0,0,0,0.1)',
          cardHoverShadow: '0 4px 6px rgba(0,0,0,0.1)',
          spacing: '16px'
        }
      });

      {% comment %}
        Optional: Log for debugging
        Remove this in production
      {% endcomment %}
      console.log('Knowledge Center initialized', {
        userEmail: {% if customer %}'{{ customer.email }}'{% else %}null{% endif %},
        userTags: userTags,
        isLoggedIn: {{ customer | json }}
      });
    });
  </script>
</body>
</html>
