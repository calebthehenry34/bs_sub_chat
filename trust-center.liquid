<section id="trust-center-{{ section.id }}" class="tc">
  <!-- Body -->
  <div class="tc-body">
    <div class="tc-container tc-grid">

      <!-- Left rail -->
      <aside class="tc-nav-wrap">
        <div class="tc-mobile-bar">
          <button class="tc-mobile-trigger" type="button" data-tc-open="true" aria-controls="tc-popover-{{ section.id }}" aria-expanded="false">
            {{ section.settings.mobile_button_label | default: 'Browse' }}
            <svg viewBox="0 0 20 20" aria-hidden="true" class="tc-caret"><path d="M5.25 7.5l4.5 4.5 4.5-4.5"/></svg>
          </button>
        </div>

        <div class="tc-search">
          <svg viewBox="0 0 20 20" aria-hidden="true"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd"/></svg>
          <input type="text" class="tc-search-input" id="tc-search-{{ section.id }}" placeholder="{{ section.settings.search_placeholder | default: 'Search trust content…' }}" autocomplete="off">
        </div>

        <nav class="tc-nav" id="tc-nav-{{ section.id }}" aria-label="Trust center navigation">
          {%- comment -%} Build unique category list {%- endcomment -%}
          {%- assign cat_buffer = '' -%}
          {%- for block in section.blocks -%}
            {%- assign c = block.settings.category -%}
            {%- if c == blank -%}{%- assign c = 'General' -%}{%- endif -%}
            {%- assign needle = c | append: '||' -%}
            {%- unless cat_buffer contains needle -%}
              {%- assign cat_buffer = cat_buffer | append: needle -%}
            {%- endunless -%}
          {%- endfor -%}
          {%- assign cat_list = cat_buffer | split: '||' -%}

          {%- comment -%} Pin Home first {%- endcomment -%}
          {%- assign pinned = '' -%}{%- assign others = '' -%}
          {%- for cat in cat_list -%}
            {%- if cat == 'Home' -%}
              {%- assign pinned = pinned | append: cat | append: '||' -%}
            {%- elsif cat != blank -%}
              {%- assign others = others | append: cat | append: '||' -%}
            {%- endif -%}
          {%- endfor -%}
          {%- assign cat_list = pinned | append: others | split: '||' -%}

          {%- for cat in cat_list -%}
            {%- if cat != blank -%}
              {%- assign is_home = false -%}
              {%- if cat == 'Home' -%}{%- assign is_home = true -%}{%- endif -%}
              <div class="tc-nav-group" data-group="{{ cat | escape }}" data-expanded="{% if is_home %}true{% else %}false{% endif %}">
                <button class="tc-nav-heading" type="button" aria-expanded="{% if is_home %}true{% else %}false{% endif %}">
                  <span>{{ cat }}</span>
                  <svg class="tc-toggle-icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M5.25 7.5l4.5 4.5 4.5-4.5"/></svg>
                </button>
                <ul class="tc-nav-list">
                  {%- for block in section.blocks -%}
                    {%- assign cat_of_block = block.settings.category -%}
                    {%- if cat_of_block == blank -%}{%- assign cat_of_block = 'General' -%}{%- endif -%}
                    {%- if cat_of_block == cat -%}
                      {%- comment -%} Resolve label including Rich/Home heading/metafield {%- endcomment -%}
                      {%- assign label = block.settings.title -%}
                      {%- if label == blank -%}
                        {%- if block.type == 'article' and block.settings.page -%}
                          {%- assign label = block.settings.page.title -%}
                        {%- elsif block.type == 'pdf' and block.settings.file_name != blank -%}
                          {%- assign label = block.settings.file_name -%}
                        {%- elsif block.type == 'external' and block.settings.external_label != blank -%}
                          {%- assign label = block.settings.external_label -%}
                        {%- elsif block.type == 'home' -%}
                          {%- assign label = block.settings.title | default: 'Home' -%}
                        {%- elsif block.type == 'rich' -%}
                          {%- if block.settings.heading != blank -%}
                            {%- assign label = block.settings.heading -%}
                          {%- elsif block.settings.heading_metafield != blank -%}
                            {%- assign label = block.settings.heading_metafield | strip_newlines -%}
                          {%- endif -%}
                        {%- endif -%}
                      {%- endif -%}
                      {%- if label == blank -%}{%- assign label = 'Untitled' -%}{%- endif -%}

                      {%- comment -%} Stable IDs: Home -> tc-home; others -> tc-{{block.id}} {%- endcomment -%}
                      {%- assign target_id = block.id | prepend: 'tc-' -%}
                      {%- if block.type == 'home' -%}{%- assign target_id = 'tc-home' -%}{%- endif -%}

                      <li class="tc-nav-item" data-title="{{ label | escape | downcase }}" data-category="{{ cat | escape | downcase }}">
                        <a class="tc-nav-link" href="#{{ target_id }}" data-target="{{ target_id }}">
                          <span class="tc-nav-text">{{ label }}</span>
                          {%- if block.settings.badge != blank -%}
                            <span class="tc-badge">{{ block.settings.badge }}</span>
                          {%- endif -%}
                        </a>
                      </li>
                    {%- endif -%}
                  {%- endfor -%}
                </ul>
              </div>
            {%- endif -%}
          {%- endfor -%}
        </nav>
      </aside>

      <!-- Right content -->
      <main class="tc-content">
        {%- for block in section.blocks -%}
          {%- comment -%} Title for panel header {%- endcomment -%}
          {%- assign title = block.settings.title -%}
          {%- if title == blank -%}
            {%- if block.type == 'article' and block.settings.page -%}
              {%- assign title = block.settings.page.title -%}
            {%- elsif block.type == 'pdf' and block.settings.file_name != blank -%}
              {%- assign title = block.settings.file_name -%}
            {%- elsif block.type == 'external' and block.settings.external_label != blank -%}
              {%- assign title = block.settings.external_label -%}
            {%- elsif block.type == 'home' -%}
              {%- assign title = block.settings.title | default: 'Home' -%}
            {%- elsif block.type == 'rich' -%}
              {%- if block.settings.heading != blank -%}
                {%- assign title = block.settings.heading -%}
              {%- elsif block.settings.heading_metafield != blank -%}
                {%- assign title = block.settings.heading_metafield -%}
              {%- endif -%}
            {%- endif -%}
          {%- endif -%}
          {%- if title == blank -%}{%- assign title = 'Untitled' -%}{%- endif -%}

          {%- assign article_id = block.id | prepend: 'tc-' -%}
          {%- if block.type == 'home' -%}{%- assign article_id = 'tc-home' -%}{%- endif -%}

          <article
            class="tc-panel"
            id="{{ article_id }}"
            data-tc-panel
            data-type="{{ block.type }}"
          >
           <header class="tc-panel-head">
  {%- if block.type == 'rich' or block.type == 'home' -%}
    <h2 class="tc-panel-title">{{ title | newline_to_br }}</h2>
  {%- else -%}
    <h2 class="tc-panel-title">{{ title }}</h2>
  {%- endif -%}

  {%- comment -%} meta (category + badge) now inside the header {%- endcomment -%}
  {%- assign cat_label = block.settings.category -%}
  {%- if cat_label == blank -%}{%- assign cat_label = 'General' -%}{%- endif -%}
  <div class="tc-panel-meta">
    <span class="tc-chip">{{ cat_label }}</span>
    {%- if block.settings.badge != blank -%}
      <span class="tc-badge">{{ block.settings.badge }}</span>
    {%- endif -%}
  </div>
</header>


            <div class="tc-panel-body">
              {%- case block.type -%}
                {%- when 'home' -%}
                  <div class="tc-richtext">
                    {%- if block.settings.intro != blank -%}
                      {{ block.settings.intro }}
                    {%- endif -%}
                  </div>

                  {%- assign has_links = false -%}
                  {%- if block.settings.ql1_label and block.settings.ql1_url %}{% assign has_links = true %}{% endif -%}
                  {%- if block.settings.ql2_label and block.settings.ql2_url %}{% assign has_links = true %}{% endif -%}
                  {%- if block.settings.ql3_label and block.settings.ql3_url %}{% assign has_links = true %}{% endif -%}
                  {%- if block.settings.ql4_label and block.settings.ql4_url %}{% assign has_links = true %}{% endif -%}

                  {%- if has_links -%}
                    <div class="tc-quick-links" style="display:flex; gap:.5rem; flex-wrap:wrap; margin-top:.75rem;">
                      {%- if block.settings.ql1_label and block.settings.ql1_url -%}<a class="tc-btn" href="{{ block.settings.ql1_url }}">{{ block.settings.ql1_label }}</a>{%- endif -%}
                      {%- if block.settings.ql2_label and block.settings.ql2_url -%}<a class="tc-btn" href="{{ block.settings.ql2_url }}">{{ block.settings.ql2_label }}</a>{%- endif -%}
                      {%- if block.settings.ql3_label and block.settings.ql3_url -%}<a class="tc-btn" href="{{ block.settings.ql3_url }}">{{ block.settings.ql3_label }}</a>{%- endif -%}
                      {%- if block.settings.ql4_label and block.settings.ql4_url -%}<a class="tc-btn" href="{{ block.settings.ql4_url }}">{{ block.settings.ql4_label }}</a>{%- endif -%}
                    </div>
                  {%- endif -%}

                  {%- assign feats = '' -%}
                  {%- if block.settings.feat_page_1 -%}{%- assign feats = feats | append: block.settings.feat_page_1.handle | append: '||' -%}{%- endif -%}
                  {%- if block.settings.feat_page_2 -%}{%- assign feats = feats | append: block.settings.feat_page_2.handle | append: '||' -%}{%- endif -%}
                  {%- if block.settings.feat_page_3 -%}{%- assign feats = feats | append: block.settings.feat_page_3.handle | append: '||' -%}{%- endif -%}
                  {%- assign feat_list = feats | split: '||' -%}
                  {%- if feat_list.size > 0 -%}
                    <div class="tc-featured-grid" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: .75rem; margin-top:1rem;">
                      {%- for h in feat_list -%}
                        {%- assign p = pages[h] -%}
                        {%- if p -%}
                          <a class="tc-card" href="{{ p.url }}" style="display:block; padding:.9rem; border:1px solid #e5e7eb; border-radius:12px; text-decoration:none; color:inherit;">
                            <div class="tc-card-title" style="font-weight:600; margin-bottom:.25rem;">{{ p.title }}</div>
                            <div class="tc-card-excerpt" style="color:#64748b; font-size:.9rem;">{{ p.content | strip_html | truncate: 110 }}</div>
                          </a>
                        {%- endif -%}
                      {%- endfor -%}
                    </div>
                  {%- endif -%}

                {%- when 'article' -%}
                  {%- if block.settings.page -%}
                    {{ block.settings.page.content }}
                  {%- else -%}
                    <p class="tc-empty">Attach a Page to this block.</p>
                  {%- endif -%}

                {%- when 'pdf' -%}
                  {%- if block.settings.file_url and block.settings.file_url != '' -%}
                    <div class="tc-file-card">
                      <div class="tc-file-info">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16c0 1.1.9 2 2 2h12a2 2 0 0 0 2-2V8l-6-6zM8 12h3a1 1 0 1 1 0 2H9v2H8v-4zm6 0h2a2 2 0 1 1 0 4h-2v-4zm1 1v2h1a1 1 0 1 0 0-2h-1z"/></svg>
                        <div>
                          <div class="tc-file-name">{{ block.settings.file_name | default: 'Document' }}</div>
                          {%- if block.settings.summary != blank -%}
                            <div class="tc-file-sub">{{ block.settings.summary }}</div>
                          {%- endif -%}
                        </div>
                      </div>
                      <a class="tc-btn" href="{{ block.settings.file_url }}" target="_blank" rel="noopener">View / Download</a>
                    </div>
                  {%- else -%}
                    <p class="tc-empty">Paste a file URL (Settings → Files) into this block.</p>
                  {%- endif -%}

                {%- when 'external' -%}
                  {%- if block.settings.external_url -%}
                    {%- if block.settings.summary != blank -%}
                      <p class="tc-external-summary">{{ block.settings.summary }}</p>
                    {%- endif -%}
                    <a class="tc-btn" href="{{ block.settings.external_url }}" target="_blank" rel="noopener">Open Resource</a>
                  {%- else -%}
                    <p class="tc-empty">Add an external URL to this block.</p>
                  {%- endif -%}

                {%- when 'rich' -%}
                  {%- if block.settings.image != blank -%}
                    <figure class="tc-figure">
                      {{ block.settings.image | image_url: width: 1600 | image_tag: loading: 'lazy', class: 'tc-image' }}
                      {%- if block.settings.image_caption != blank -%}
                        <figcaption class="tc-figcap">{{ block.settings.image_caption }}</figcaption>
                      {%- endif -%}
                    </figure>
                  {%- endif -%}

                  {%- if block.settings.video_url != blank -%}
                    <div class="tc-video-wrap">
                      {{ block.settings.video_url | external_video_tag: class: 'tc-video' }}
                    </div>
                  {%- endif -%}

                  <div class="tc-richtext">
                    {%- if block.settings.content != blank -%}
                      {{ block.settings.content }}
                    {%- elsif block.settings.multi_metafield != blank -%}
                      {{ block.settings.multi_metafield | newline_to_br }}
                    {%- else -%}
                      <p class="tc-empty">Add rich text content to this block.</p>
                    {%- endif -%}
                    {%- when 'liquid' -%}
  {%- if block.settings.liquid_code != blank -%}
    {{ block.settings.liquid_code }}
  {%- elsif request.design_mode -%}
    <div class="tc-hint">Add Liquid in this block’s settings.</div>
  {%- endif -%}

{%- when 'snippet' -%}
  {%- assign resource_obj = nil -%}
  {%- if block.settings.pass_resource -%}
    {%- if template.name contains 'product' and product -%}{% assign resource_obj = product %}
    {%- elsif template.name contains 'collection' and collection -%}{% assign resource_obj = collection %}
    {%- elsif template.name contains 'article' and article -%}{% assign resource_obj = article %}
    {%- elsif page -%}{% assign resource_obj = page %}{% endif -%}
  {%- endif -%}

  {%- if block.settings.snippet_name != blank -%}
    {%- comment %}
      Pass two optional args:
      - resource: the detected page/product/collection/article (if enabled)
      - data: JSON string (the snippet can parse with | parse_json)
    {% endcomment -%}
    {% render block.settings.snippet_name,
      resource: resource_obj,
      data: block.settings.param_json,
      section_id: section.id,
      block_id: block.id
    %}
  {%- elsif request.design_mode -%}
    <div class="tc-hint">Enter a snippet name (e.g. <code>trust-card</code>).</div>
  {%- endif -%}
                  </div>
              {%- endcase -%}
            </div>
          </article>
        {%- endfor -%}

        {%- if section.blocks.size == 0 -%}
          <div class="tc-empty tc-empty-big">
            <p>No trust content yet. Add blocks in the editor.</p>
          </div>
        {%- endif -%}
      </main>
    </div>
  </div>

  <!-- Mobile Drawer -->
  <div class="tc-popover" id="tc-popover-{{ section.id }}" aria-hidden="true">
    <div class="tc-popover-backdrop" data-tc-close="true"></div>
    <div class="tc-popover-panel" role="dialog" aria-modal="true" aria-label="Trust Center Menu">
      <div class="tc-popover-head">
        <h3>{{ section.settings.mobile_menu_title | default: 'Trust Center' }}</h3>
        <button class="tc-popover-close" data-tc-close="true" aria-label="Close menu">✕</button>
      </div>
      <div class="tc-popover-body">
        <div class="tc-popover-nav" id="tc-popover-nav-{{ section.id }}"></div>
      </div>
    </div>
  </div>
</section>

<style>
/* Base + layout */
.tc{ color:#111; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,system-ui,sans-serif; background:#fafafa; }
.tc-body{ padding:16px 0 56px; }
.tc-container{ max-width:{{ section.settings.max_width }}px; margin:0 auto; padding:0 20px; }

/* App grid */
.tc-grid{ display:grid; grid-template-columns: 300px 1fr; gap:0; min-height:60vh; background:#fff; border:1px solid #e5e7eb; border-radius:14px; overflow:hidden; }
@media (max-width: 991px){ .tc-grid{ grid-template-columns: 1fr; } }

/* Left rail */
.tc-nav-wrap{ border-right:1px solid #e5e7eb; background:#fff; padding:16px; position:relative; }
.tc-mobile-bar{ display:none; margin-bottom:.75rem; }
@media (max-width: 991px){
  .tc-container {    padding: 0}
  .tc-nav-wrap{ border-right:none; border-bottom:1px solid #e5e7eb; }
  .tc-mobile-bar{ display:flex; }
}
.tc-mobile-trigger{ display:inline-flex; align-items:center; gap:.5rem; padding:.625rem .875rem; border:1.5px solid #e5e7eb; border-radius:10px; background:#fff; width: 100%;
    justify-content: space-between;}
.tc-caret{ width:16px;height:16px; }

/* Search */
.tc-search{ position:relative; margin-bottom:10px; }
.tc-search svg{ position:absolute; left:12px; top:50%; transform:translateY(-50%); width:18px;height:18px; color:#6b7280; pointer-events:none; }
.tc-search-input{ width:100%; padding:.6rem .75rem .6rem 36px; border:1.5px solid #e5e7eb; border-radius:10px; }

/* Desktop nav list */
.tc-nav{ position:sticky; top:16px; max-height:calc(100vh - 160px); overflow:auto; padding-right:6px; }
.tc-nav-group{ padding:14px 0; border-top:1px solid #e5e7eb; }
.tc-nav-group:first-child{ border-top:none; padding-top:0; }
.tc-nav-heading{ display:flex; align-items:center; justify-content:space-between; width:100%; font-size:.72rem; color:black; font-family:"manrope"; text-transform:uppercase; letter-spacing:.1em; font-weight:600; margin:0 0 .5rem; background:none; border:none; padding:.3rem .35rem; border-radius:6px; cursor:pointer; transition: background .15s; }
.tc-nav-heading:hover{ background:#f1f5f9; }
.tc-toggle-icon{ width:14px; height:14px; color:#94a3b8; transition: transform .2s ease; }
.tc-nav-group[data-expanded="true"] .tc-toggle-icon{ transform: rotate(0deg); }
.tc-nav-group[data-expanded="false"] .tc-toggle-icon{ transform: rotate(-90deg); }
.tc-nav-list{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:1px; max-height:1000px; overflow:hidden; transition: max-height .3s ease, opacity .2s ease; opacity:1; }
.tc-nav-group[data-expanded="false"] .tc-nav-list{ max-height:0; opacity:0; }
.tc-nav-link{ display:flex; align-items:center; gap:.35rem; padding:.45rem .5rem; border-radius:8px; text-decoration:none; color:#111; border:1px solid transparent; }
.tc-nav-link:hover{ background:#f8fafc; }
.tc-nav-link.is-active{ border-color:#111; background:#f9fafb; }
.tc-badge{ background:#111; color:#fff; font-size:.7rem; padding:.2rem .5rem; border-radius:999px; margin-left:auto; }

/* Content */
.tc-content{ padding:24px; }
@media (max-width: 991px){ .tc-content{ padding:10px; } }
.tc-panel{ display:none; }
.tc-panel.is-active{ display:block; }
/* Fallback: show first panel if JS hasn't run yet */
.tc:not(.tc--js) .tc-content .tc-panel:first-of-type{ display:block; }

.tc-panel-head{ display:flex; align-items:center; gap:.5rem; justify-content:space-between; margin-bottom:.5rem; border-bottom:1px solid #e5e7eb; padding-bottom:.5rem; padding:15px; padding-left:0px;}
.tc-panel-title{ font-size: clamp(22px, 3vw, 28px); margin:0; letter-spacing:-.01em; }
.tc-panel-meta{ display:flex; flex-wrap:wrap; gap:.5rem; margin:10px 0 16px; }
.tc-chip{ background:#f3f4f6; color:#374151; padding:.25rem .5rem; border-radius:999px; font-size:.75rem; }

.tc-file-card{ display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:1rem; border:1px solid #e5e7eb; border-radius:12px; background:#fff; }
.tc-file-info{ display:flex; gap:.75rem; align-items:center; }
.tc-file-info svg{ width:24px;height:24px; color:#374151; }
.tc-file-name{ font-weight:600; }
.tc-file-sub{ font-size:.9rem; color:#6b7280; }
.tc-btn{ display:inline-flex; align-items:center; justify-content:center; padding:.6rem .9rem; border-radius:10px; background:#111; color:#fff; text-decoration:none; }

.tc-figure{ margin:0 0 1rem; }
.tc-image{ width:100%; height:auto; border-radius:12px; display:block; }
.tc-figcap{ font-size:.85rem; color:#64748b; margin-top:.4rem; }
.tc-video-wrap{ position:relative; width:100%; aspect-ratio:16/9; margin:0 0 1rem; }
.tc-video-wrap iframe, .tc-video{ width:100%; height:100%; border:0; border-radius:12px; }
.tc-richtext :is(h2,h3,h4){ margin:1.25rem 0 .6rem; }
.tc-richtext p{ margin:.75rem 0; line-height:1.7; color:#374151; padding:10px;}
.tc-richtext ul, .tc-richtext ol{ margin:.8rem 0 .8rem 1.25rem; }
.tc-richtext li{ margin:.35rem 0; }

.tc-external-summary{ margin:0 0 .75rem; color:#374151; }
.tc-empty{ color:#6b7280; }
.tc-empty-big{ text-align:center; padding:2rem; border:1px dashed #e5e7eb; border-radius:12px; }

/* --- MOBILE: show only Browse button + Search in the left rail --- */
@media (max-width: 991px){
  /* Hide every direct child of the left rail… */
  .tc-nav-wrap > * { display:none !important; }

  /* …but keep the mobile bar (Browse) and search visible */
  .tc-nav-wrap .tc-mobile-bar,
  .tc-nav-wrap .tc-search { display:block !important; }

  /* Ensure the search wrapper lays out nicely */
  .tc-nav-wrap .tc-mobile-bar{ margin-bottom:.5rem; }
  .tc-nav-wrap .tc-search{ margin:0; }
}

/* Mobile drawer (overlay, delay, z-index above navbar) */
.tc-popover{ position:fixed; inset:0; display:block; pointer-events:none; z-index:9999; }
.tc-popover[aria-hidden="true"] .tc-popover-backdrop{ opacity:0; }
.tc-popover[aria-hidden="true"] .tc-popover-panel{ transform: translateX(-105%); }
.tc-popover[aria-hidden="false"]{ pointer-events:auto; }
.tc-popover-backdrop{ position:absolute; inset:0; background:rgba(17,24,39,.45); transition: opacity 160ms ease; }
.tc-popover-panel{
  position:absolute; left:0; top:0; bottom:0; width:min(90vw,360px);
  background:#fff; display:flex; flex-direction:column;
  box-shadow: 0 10px 30px rgba(0,0,0,.2);
  transform: translateX(-105%);
  transition: transform 220ms cubic-bezier(.22,.61,.36,1);
  will-change: transform;
}
.tc-popover.is-opening .tc-popover-panel{ transform: translateX(0); }
.tc-popover.is-opening .tc-popover-backdrop{ opacity:1; }
.tc-popover.is-closing .tc-popover-panel{ transform: translateX(-105%); }
.tc-popover.is-closing .tc-popover-backdrop{ opacity:0; }
.tc-popover-head{ display:flex; align-items:center; justify-content:space-between; padding:.9rem 1rem; border-bottom:1px solid #eef2f7; }
.tc-popover-body{ padding:.75rem 1rem; overflow:auto; }
.tc-popover-close{ background:transparent; border:none; font-size:18px; line-height:1; cursor:pointer; }
.tc-popover-nav .tc-nav-group{ margin:0; border-top:1px solid #f1f5f9; padding:10px 0; }
.tc-popover-nav .tc-nav-link{ padding:.55rem .625rem; }
@media (min-width: 992px){ .tc-popover{ display:none !important; } }

/* --- Make Welcome panel start at top on mobile --- */
@media (max-width: 991px){
  /* Remove the large top/bottom padding from the section wrapper */
  .tc-body { 
    padding-top: 0;
    padding-bottom: 0;
  }

  /* Let the grid auto-size to its content instead of forcing 60vh */
  .tc-grid {
    min-height: auto;
  }

  /* Optional: give the content a little breathing room */
  .tc-content {
    padding-top: 1rem;
  }
}
/* --- Place category + badges on the far right of the panel heading --- */
.tc-panel-head {
  display: flex;
  justify-content: space-between;   /* pushes left/right apart */
  align-items: center;
}

.tc-panel-title {
  margin: 0;                        /* keep title tight to the left */
}

/* move the meta info to the right end of the same row */
.tc-panel-meta {
  margin: 0;                        /* remove top/bottom gap */
  display: flex;
  gap: .5rem;
}

</style>


<script>
(function(){
  document.addEventListener('DOMContentLoaded', initTrustCenter);
  document.addEventListener('shopify:section:load', initTrustCenter);

  function initTrustCenter(e){
    // Scope
    var rootId = '{{ section.id }}';
    var scope = document.getElementById('trust-center-' + rootId);
    if(!scope) return;

    // Guard against double init
    if(scope.dataset.tcInit === '1') return;
    scope.dataset.tcInit = '1';
    scope.classList.add('tc--js');

    // Nodes
    var nav = scope.querySelector('#tc-nav-' + rootId);
    var search = scope.querySelector('#tc-search-' + rootId);
    var popover = scope.querySelector('#tc-popover-' + rootId);
    var popoverNavMount = scope.querySelector('#tc-popover-nav-' + rootId);
    var openBtns = scope.querySelectorAll('[data-tc-open="true"]');

    // Category toggle (accordion)
    function wireToggles(container){
      if(!container) return;
      var groups = container.querySelectorAll('.tc-nav-group');
      groups.forEach(function(group){
        var heading = group.querySelector('.tc-nav-heading');
        if(!heading) return;
        heading.addEventListener('click', function(){
          var isExpanded = group.getAttribute('data-expanded') === 'true';
          group.setAttribute('data-expanded', isExpanded ? 'false' : 'true');
          heading.setAttribute('aria-expanded', isExpanded ? 'false' : 'true');
        });
      });
    }

    // Build drawer nav clone
    function buildDrawerNav(){
      if(!nav || !popoverNavMount) return;
      popoverNavMount.innerHTML = nav.outerHTML; // fresh clone
      var clone = popoverNavMount.querySelector('.tc-nav');
      if(clone){
        clone.id = 'tc-nav-clone-' + rootId;
        wire(clone);
        wireToggles(clone);
      }
    }
    buildDrawerNav();

    // Drawer behavior (open/close with delay + scroll lock)
    var OPEN_DELAY = 20, CLOSE_DELAY = 220;
    function lockScroll(){ document.documentElement.style.overflow = 'hidden'; }
    function unlockScroll(){ document.documentElement.style.overflow = ''; }
    function openDrawer(){
      if(!popover) return;
      popover.setAttribute('aria-hidden','false');
      popover.classList.remove('is-closing');
      setTimeout(function(){ popover.classList.add('is-opening'); lockScroll(); }, OPEN_DELAY);
      openBtns.forEach(function(btn){ btn.setAttribute('aria-expanded','true'); });
    }
    function closeDrawer(){
      if(!popover) return;
      popover.classList.remove('is-opening');
      popover.classList.add('is-closing');
      setTimeout(function(){
        popover.setAttribute('aria-hidden','true');
        popover.classList.remove('is-closing');
        unlockScroll();
        openBtns.forEach(function(btn){ btn.setAttribute('aria-expanded','false'); });
      }, CLOSE_DELAY);
    }
    if(openBtns && popover){
      openBtns.forEach(function(btn){ btn.addEventListener('click', openDrawer); });
    }
    if(popover){
      popover.querySelectorAll('[data-tc-close="true"], .tc-popover-backdrop')
        .forEach(function(el){ el.addEventListener('click', closeDrawer); });
    }

    // Core activation
    function panelIds(){
      return Array.prototype.map.call(scope.querySelectorAll('[data-tc-panel]'), function(p){ return p.id; });
    }
    function setActive(targetId){
      if(!targetId) return;
      var ids = panelIds();
      if(ids.indexOf(targetId) === -1){
        // Fallback to first available
        targetId = ids[0] || null;
        if(!targetId) return;
      }

      // Clear actives
      scope.querySelectorAll('.tc-nav a.is-active').forEach(function(a){ a.classList.remove('is-active'); });
      if(popover) popover.querySelectorAll('.tc-nav a.is-active').forEach(function(a){ a.classList.remove('is-active'); });
      scope.querySelectorAll('[data-tc-panel].is-active').forEach(function(p){ p.classList.remove('is-active'); });

      // Mark nav links active (desktop + clone)
      function mark(list){
        list.forEach(function(a){
          var href = a.getAttribute('href') || '';
          if(href.charAt(0) === '#'){ href = href.slice(1); }
          if(href === targetId || a.dataset.target === targetId){ a.classList.add('is-active'); }
        });
      }
      mark(scope.querySelectorAll('.tc-nav a'));
      if(popover) mark(popover.querySelectorAll('.tc-nav a'));

      // Show panel
      var panel = scope.querySelector('#' + CSS.escape(targetId));
      if(panel){
        panel.classList.add('is-active');
        if(location.hash !== '#' + targetId){ history.replaceState(null, '', '#' + targetId); }
      }

      // Close drawer if open
      if(popover && popover.getAttribute('aria-hidden') === 'false'){ closeDrawer(); }
    }

    // Wire clicks to activate
    function wire(container){
      if(!container) return;
      container.addEventListener('click', function(e){
        var link = e.target.closest('a.tc-nav-link');
        if(!link) return;
        var href = link.getAttribute('href') || '';
        if(href.indexOf('#') !== 0) return; // external link
        e.preventDefault();
        setActive(href.slice(1));
      });
    }
    wire(nav);

    // Sync from hash (for external links / topics bar)
    function activateFromHash(){
      var h = location.hash ? location.hash.slice(1) : '';
      if(h){ setActive(h); return; }
      // Default: Home if present else first
      var home = scope.querySelector('[data-type="home"]');
      var first = scope.querySelector('[data-tc-panel]');
      setActive(home ? home.id : (first ? first.id : null));
    }
    window.addEventListener('hashchange', function(){ activateFromHash(); });

    // Search mirrors to drawer
    function filterNav(q){
      var query = (q || '').trim().toLowerCase();
      var navs = [scope.querySelector('.tc-nav')];
      if(popover){ navs.push(popover.querySelector('.tc-nav')); }
      navs.filter(Boolean).forEach(function(n){
        n.querySelectorAll('.tc-nav-group').forEach(function(group){
          var visible = 0;
          group.querySelectorAll('.tc-nav-item').forEach(function(item){
            var t = (item.dataset.title || '').toLowerCase();
            var c = (item.dataset.category || '').toLowerCase();
            var match = !query || t.indexOf(query) > -1 || c.indexOf(query) > -1;
            item.style.display = match ? '' : 'none';
            if(match) visible++;
          });
          group.style.display = visible ? '' : 'none';
          var head = group.querySelector('.tc-nav-heading');
          if(head) head.style.opacity = visible ? '1' : '.4';
        });
      });
    }
    if(search){
      var t;
      search.addEventListener('input', function(){
        clearTimeout(t);
        var v = this.value; t = setTimeout(function(){ filterNav(v); }, 120);
      });
    }

    // Wire desktop nav toggles
    wireToggles(nav);

    // Initial activation (after drawer clone exists)
    activateFromHash();
  }
})();
</script>


{% schema %}
{
  "name": "Trust Center",
  "settings": [
    { "type": "text", "id": "search_placeholder", "label": "Search placeholder", "default": "Search trust content…" },
    { "type": "text", "id": "mobile_button_label", "label": "Mobile menu button label", "default": "Browse" },
    { "type": "text", "id": "mobile_menu_title", "label": "Mobile drawer title", "default": "Trust Center" },
    { "type": "range", "id": "max_width", "min": 960, "max": 1440, "step": 10, "unit": "px", "label": "Max width", "default": 1200 }
  ],
  "blocks": [
    {
      "type": "home",
      "name": "Home (overview)",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "title", "label": "Title", "default": "Welcome" },
        { "type": "text", "id": "category", "label": "Category", "default": "Home" },
        { "type": "text", "id": "badge", "label": "Badge" },
        { "type": "richtext", "id": "intro", "label": "Intro content", "default": "<p>Start here to explore research, lab results, certifications, and product documentation.</p>" },

        { "type": "header", "content": "Quick links (optional)" },
        { "type": "text", "id": "ql1_label", "label": "Link 1 label", "default": "Research" },
        { "type": "url",  "id": "ql1_url",   "label": "Link 1 URL" },
        { "type": "text", "id": "ql2_label", "label": "Link 2 label", "default": "Lab Results" },
        { "type": "url",  "id": "ql2_url",   "label": "Link 2 URL" },
        { "type": "text", "id": "ql3_label", "label": "Link 3 label", "default": "Certifications" },
        { "type": "url",  "id": "ql3_url",   "label": "Link 3 URL" },
        { "type": "text", "id": "ql4_label", "label": "Link 4 label" },
        { "type": "url",  "id": "ql4_url",   "label": "Link 4 URL" },

        { "type": "header", "content": "Featured documents (optional)" },
        { "type": "page", "id": "feat_page_1", "label": "Featured Page 1" },
        { "type": "page", "id": "feat_page_2", "label": "Featured Page 2" },
        { "type": "page", "id": "feat_page_3", "label": "Featured Page 3" }
      ]
    },
    {
      "type": "article",
      "name": "Article (Page)",
      "settings": [
        { "type": "text", "id": "title", "label": "Custom title (optional)" },
        { "type": "page", "id": "page", "label": "Select page" },
        { "type": "text", "id": "category", "label": "Category", "default": "Overview" },
        { "type": "text", "id": "badge", "label": "Badge (e.g., Verified, New)" }
      ]
    },
    {
      "type": "pdf",
      "name": "Document (File/PDF)",
      "settings": [
        { "type": "text", "id": "title", "label": "Title" },
        { "type": "url", "id": "file_url", "label": "File URL (paste from Settings → Files)" },
        { "type": "text", "id": "file_name", "label": "File name (display)", "default": "Certificate of Analysis (COA)" },
        { "type": "textarea", "id": "summary", "label": "Short description" },
        { "type": "text", "id": "category", "label": "Category", "default": "Certificates" },
        { "type": "text", "id": "badge", "label": "Badge" }
      ]
    },
    {
      "type": "external",
      "name": "External resource",
      "settings": [
        { "type": "text", "id": "external_label", "label": "Link label", "default": "Third-party lab results portal" },
        { "type": "url", "id": "external_url", "label": "External URL" },
        { "type": "textarea", "id": "summary", "label": "Short description" },
        { "type": "text", "id": "category", "label": "Category", "default": "External" },
        { "type": "text", "id": "badge", "label": "Badge" }
      ]
    },
    {
      "type": "rich",
      "name": "Rich content",
      "settings": [
        { "type": "text", "id": "heading", "label": "Heading" },
        { "type": "textarea", "id": "heading_metafield", "label": "Dynamic source (multi-line heading metafield)" },

        { "type": "richtext", "id": "content", "label": "Content (manual rich text)" },
        { "type": "textarea", "id": "multi_metafield", "label": "Dynamic source (multi-line text metafield)" },

        { "type": "image_picker", "id": "image", "label": "Image (optional)" },
        { "type": "text", "id": "image_caption", "label": "Image caption (optional)" },
        { "type": "video_url", "id": "video_url", "label": "Video URL (YouTube/Vimeo)", "accept": ["youtube","vimeo"] },
        { "type": "text", "id": "category", "label": "Category", "default": "Overview" },
        { "type": "text", "id": "badge", "label": "Badge" }
      ]
    },
    {
  "type": "liquid",
  "name": "Liquid",
  "settings": [
     { "type": "text", "id": "title", "label": "Title" },
     { "type": "text", "id": "heading", "label": "Heading" },
     { "type": "text", "id": "category", "label": "Category", "default": "Overview" },
     { "type": "text", "id": "badge", "label": "Badge" },
    {
      "type": "liquid",
      "id": "liquid_code",
      "label": "Liquid code",
      "info": "Write Liquid/HTML. Great for small custom logic or simple embeds."
    }
  ]
},
{
  "type": "snippet",
  "name": "Snippet",
  "limit": 20,
  "settings": [
    {
      "type": "text",
      "id": "snippet_name",
      "label": "Snippet name",
      "placeholder": "trust-card"
    },
    {
      "type": "checkbox",
      "id": "pass_resource",
      "label": "Pass current resource (page/product/collection/article)",
      "default": true
    },
  ]
}

  ],
  "max_blocks": 50,
  "presets": [
    { "name": "Trust Center" }
  ]
}
{% endschema %}
