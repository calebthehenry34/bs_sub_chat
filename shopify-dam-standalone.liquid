{% comment %}
  Shopify DAM - Standalone Version
  NO external backend required - runs entirely in Shopify!

  Access: admin or affiliate tagged customers only
  Storage: Browser localStorage (per device)
  Files: Add by URL from Shopify Admin → Settings → Files
{% endcomment %}

{% if customer %}
  {% assign has_access = false %}
  {% for tag in customer.tags %}
    {% assign tag_lower = tag | downcase %}
    {% if tag_lower == 'admin' or tag_lower == 'affiliate' %}
      {% assign has_access = true %}
    {% endif %}
  {% endfor %}

  {% if has_access %}
    <div id="shopify-dam-container"></div>

    {{ 'shopify-dam-standalone.js' | asset_url | script_tag }}

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var userTags = [];
        {% for tag in customer.tags %}
          userTags.push('{{ tag | escape }}');
        {% endfor %}

        var dam = new ShopifyDAM({
          containerId: 'shopify-dam-container',
          userEmail: '{{ customer.email | escape }}',
          userTags: userTags,
          theme: {
            primaryColor: '{{ section.settings.primary_color | default: "#2563eb" }}',
            secondaryColor: '{{ section.settings.secondary_color | default: "#64748b" }}',
            backgroundColor: '{{ section.settings.background_color | default: "#f8fafc" }}',
            cardBackground: '{{ section.settings.card_background | default: "#ffffff" }}',
            textColor: '{{ section.settings.text_color | default: "#1e293b" }}',
            borderColor: '{{ section.settings.border_color | default: "#e2e8f0" }}'
          }
        });
        dam.init();
      });
    </script>
  {% else %}
    <div style="text-align:center;padding:60px 20px;background:#fef2f2;border-radius:12px;max-width:500px;margin:40px auto;">
      <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      <h3 style="color:#991b1b;margin:16px 0 8px;">Access Restricted</h3>
      <p style="color:#b91c1c;margin:0;">This feature is only available to administrators and affiliates.</p>
    </div>
  {% endif %}
{% else %}
  <div style="text-align:center;padding:60px 20px;background:#f8fafc;border-radius:12px;max-width:500px;margin:40px auto;">
    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#2563eb" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    <h3 style="margin:16px 0 8px;">Login Required</h3>
    <p style="color:#64748b;margin:0 0 20px;">Please log in to access the Digital Asset Manager.</p>
    <a href="/account/login?return_url={{ request.path | url_encode }}" style="display:inline-block;padding:12px 24px;background:#2563eb;color:white;border-radius:8px;text-decoration:none;font-weight:500;">Log In</a>
  </div>
{% endif %}

{% schema %}
{
  "name": "Digital Asset Manager",
  "settings": [
    { "type": "color", "id": "primary_color", "label": "Primary Color", "default": "#2563eb" },
    { "type": "color", "id": "secondary_color", "label": "Secondary Color", "default": "#64748b" },
    { "type": "color", "id": "background_color", "label": "Background", "default": "#f8fafc" },
    { "type": "color", "id": "card_background", "label": "Card Background", "default": "#ffffff" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#1e293b" },
    { "type": "color", "id": "border_color", "label": "Border Color", "default": "#e2e8f0" }
  ],
  "presets": [{ "name": "Digital Asset Manager" }]
}
{% endschema %}
