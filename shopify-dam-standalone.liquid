{% comment %}
  Shopify DAM - Premium Digital Asset Manager

  Features:
  - Direct file upload (drag & drop)
  - Admin-only upload/delete permissions
  - Affiliate read-only access
  - High-end responsive UI
{% endcomment %}

{% if request.design_mode %}
  <div id="shopify-dam-container"></div>
  {{ 'shopify-dam-standalone.js' | asset_url | script_tag }}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      new ShopifyDAM({
        containerId: 'shopify-dam-container',
        userTags: ['admin'],
        isAdmin: true,
        isDesignMode: true
      }).init();
    });
  </script>

{% elsif customer %}
  {% assign is_admin = false %}
  {% assign has_access = false %}

  {% for tag in customer.tags %}
    {% assign tag_lower = tag | downcase %}
    {% if tag_lower == 'admin' %}
      {% assign is_admin = true %}
      {% assign has_access = true %}
    {% elsif tag_lower == 'affiliate' %}
      {% assign has_access = true %}
    {% endif %}
  {% endfor %}

  {% if has_access %}
    <div id="shopify-dam-container"></div>
    {{ 'shopify-dam-standalone.js' | asset_url | script_tag }}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var userTags = [];
        {% for tag in customer.tags %}
          userTags.push('{{ tag | escape }}');
        {% endfor %}

        new ShopifyDAM({
          containerId: 'shopify-dam-container',
          userEmail: '{{ customer.email | escape }}',
          userTags: userTags,
          isAdmin: {{ is_admin }}
        }).init();
      });
    </script>
  {% else %}
    <div style="max-width:420px;margin:60px auto;text-align:center;padding:48px 32px;background:#fff;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.06);">
      <div style="width:72px;height:72px;background:#FEE2E2;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
      </div>
      <h2 style="font-size:22px;font-weight:700;margin:0 0 8px;color:#1F2937;">Access Restricted</h2>
      <p style="color:#6B7280;margin:0;line-height:1.6;">This area is only available to administrators and affiliates.</p>
    </div>
  {% endif %}

{% else %}
  <div style="max-width:420px;margin:60px auto;text-align:center;padding:48px 32px;background:#fff;border-radius:16px;box-shadow:0 4px 24px rgba(0,0,0,0.06);">
    <div style="width:72px;height:72px;background:#E8F1FA;border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 24px;">
      <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#78ABE6" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
    </div>
    <h2 style="font-size:22px;font-weight:700;margin:0 0 8px;color:#1F2937;">Login Required</h2>
    <p style="color:#6B7280;margin:0 0 28px;line-height:1.6;">Please log in to access Marketing Resources.</p>
    <a href="/account/login?return_url={{ request.path | url_encode }}" style="display:inline-block;padding:14px 32px;background:#78ABE6;color:white;text-decoration:none;border-radius:10px;font-weight:600;font-size:15px;box-shadow:0 4px 12px rgba(120,171,230,0.4);transition:transform 0.2s,box-shadow 0.2s;">Log In</a>
  </div>
{% endif %}

{% schema %}
{
  "name": "Marketing Resources",
  "tag": "section",
  "class": "dam-section",
  "settings": [],
  "presets": [{ "name": "Marketing Resources" }]
}
{% endschema %}
